# Redwood Studio [Experimental]

RedwoodJS Studio is an experimental package used during development to gain runtime insights into a project.

## Motivation

Redwood provides tools that lets developers "get to work on what makes your application special, instead of wasting cycles choosing and re-choosing various technologies and configurations."[1](https://github.com/redwoodjs/redwood/blob/main/README.md).

Much happens while your app processes a request: Invoke a function; handle a GraphQL request; resolve the request with a service; build and execute a SQL statement; connect to the database; handle the query response; further resolve the response so in contains all the data needed; return the result ... and more.

While [logging](https://redwoodjs.com/docs/logger) can show you some of these steps, there is no easy way to see how the relate to each other, compare, or break down individual timings. Observability needed to debug, iterate, try out, and refactor your code is lacking.

We hope Studio helps solve this problem with an observability tool that combines:

* Tracing with OpenTelemetry (service and GraphQL)
* SQL statement logging
* general metrics (how many invocations)
* GraphiQL playground with impersonated authentication

With Studio, it is easier to:

* identify slow running SQL statements without reviewing captured log files
* identify and improve N+1 queries by comparing before and after traces
* impersonate the user authentication headers in GraphiQL

## Running Studio

To run the redwood studio simply execute the following redwood cli command:
```bash
yarn rw experimental studio
```

## Studio Config

You may provide the following configuration options in your `redwood.toml` file to control the behaviour of the studio.

```toml
[experimental.studio]
  # Determines whether the studio should run with an in memory database or persist the data to a file in your project within `./redwood`
  inMemory = false

[experimental.studio.graphiql]
  endpoint = 'graphql'

[experimental.studio.graphiql.authImpersonation]
  # authProvider = undefined (default value)
  jwtSecret = 'secret'
  # userId = undefined (default value)
  # email = undefined (default value)
  # roles = undefined (default value)
```

## OpenTelemetry Ingestion

The redwood studio can ingest your OpenTelemetry data and indeed requires this data to power the insights that it is able to provide.

To enable ingestion of OpenTelemetry tracing into the studio please provide the following export location for your tracing data within `opentelemetry.js` to be `http://127.0.0.1:4318/v1/traces` which is the default generated by the OpenTelemetry setup command.
```ts
const exporter = new OTLPTraceExporter({
  // Update this URL to point to where your OTLP compatible collector is listening
  // The redwood development studio (`yarn rw exp studio`) can collect your telemetry at `http://127.0.0.1:4318/v1/traces`
  url: 'http://127.0.0.1:4318/v1/traces',
})
```

## GraphiQL Auth Impersonation

### DbAuth

Requires `SESSION_SECRET` envar for cookie encryption.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "dbAuth"
  email = "user@example.com"
  userId = "1"
```

### Netlify

Since Netlify does not expose the JWT secret used to sign the token in production, impersonation requires a `jwtSecret` to encode and decode the auth token.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "netlify"
  email = "user@example.com"
  userId = "1"
  jwtSecret = "some-secret-setting"
```

### Supabase

Requires `SUPABASE_JWT_SECRET` envar for JWT signing.

TOML example:

```toml
[web]
  port = 8888
[experimental.studio]
  inMemory = false
[experimental.studio.graphiql]
  endpoint = "graphql"
[experimental.studio.graphiql.authImpersonation]
  authProvider = "supabase"
  email = "user@example.com"
  userId = "1"
```

## Future

Since Studio is experiment, its feature set will change. Some will be added, others improved, and several perhaps removed.

Some ideas to improve the Studio are:

* More metric widgets
  * time from launch
  * count of queries/services/functions
  * etc
* Annotations
  * add warnings on slow queries
  * add warning on possible N+1
* Charts and visualizations
  * Line charts of request over time
  * Histograms of executing timings per request
* Track errors
  * Capture api-side errors for review
  * Perhaps via Envelop GraphQL plugin
* Instrument web side
* ChatGPT UI to ask questions about schema
* Prisma ER diagrams
* Send api logs via Pino transport
* Search
    * Prisma
    * Tracing
    * Errors
* Notification on warnings
  * issue to fix like n+1
* Custom dashboards with specific charts, or service or GraphQL focus
* Intelligence
  * anomalies
  * trends
  * warn on issues before they happen
* More tags and data per request
  * Prisma version
  * RedwoodJS Version

## Contributing

We welcome your [feedback](https://community.redwoodjs.com/t/redwood-studio-experimental/4771) and also your contributions to improve Studio.

For more [information on contributing](https://github.com/redwoodjs/redwood/blob/main/CONTRIBUTING.md) see: https://github.com/redwoodjs/redwood/blob/main/CONTRIBUTING.md
